<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Empire: Dawn of War</title>
    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
        }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: #000; 
            position: fixed; 
            font-family: 'Arial', sans-serif;
        }

        /* –ó–ê–ì–†–£–ó–ö–ê */
        #loading-screen {
            position: fixed; 
            inset: 0; 
            background: url('bg.png') no-repeat center center / cover;
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
            align-items: center;
            z-index: 5000; 
            padding: 60px 0;
        }
        .game-title { 
            color: #ffd700; 
            font-size: clamp(24px, 5vw, 32px); 
            font-weight: bold; 
            text-align: center; 
            text-shadow: 0 0 15px #000; 
            text-transform: uppercase; 
            font-family: serif; 
        }
        .loader-wrap { 
            width: 85%; 
            max-width: 400px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .loader-cont { 
            width: 100%; 
            height: 26px; 
            background: #000; 
            border: 4px solid #ffd700; 
            position: relative; 
            border-radius: 4px;
            overflow: hidden;
        }
        #progress { 
            width: 0%; 
            height: 100%; 
            background: linear-gradient(180deg, #fff2ac, #ffd700, #b8860b);
            transition: width 0.1s ease;
        }

        /* –î–ò–ê–õ–û–ì */
        #dialog-screen { 
            position: fixed; 
            inset: 0; 
            z-index: 4000; 
            display: none;
            background: linear-gradient(to bottom, transparent 20%, #000 90%);
            flex-direction: column; 
            justify-content: flex-end; 
            align-items: center;
        }
        .character-img { 
            height: 75%; 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            z-index: 1; 
            object-fit: contain;
        }
        .dialog-box { 
            width: 100%; 
            background: rgba(10, 10, 10, 0.98); 
            border-top: 4px solid #ffd700; 
            padding: 30px 20px; 
            color: white; 
            z-index: 10; 
            font-family: serif; 
        }
        .btn-game { 
            background: #8b0000; 
            color: #ffd700; 
            border: 2px solid #ffd700; 
            padding: 18px; 
            width: 100%; 
            margin-top: 15px; 
            font-weight: bold; 
            text-transform: uppercase; 
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .btn-game:hover {
            background: #a00000;
        }

        /* –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù - –¢–ï–ü–ï–†–¨ –ö–ê–†–¢–ê –ó–ê–ù–ò–ú–ê–ï–¢ –í–°–Å */
        #game-viewport { 
            width: 100vw; 
            height: 100vh; 
            position: relative; 
            display: none; 
            overflow: hidden; 
            cursor: grab;
            touch-action: none;
        }
        
        /* –ö–ê–†–¢–ê - –¢–ï–ü–ï–†–¨ –ë–û–õ–¨–®–û–ô –§–û–ù, –ö–û–¢–û–†–´–ô –ú–û–ñ–ù–û –î–í–ò–ì–ê–¢–¨ */
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 200vw;  /* –í 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —ç–∫—Ä–∞–Ω–∞ */
            height: 200vh; /* –í 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —ç–∫—Ä–∞–Ω–∞ */
            min-width: 100vw;
            min-height: 100vh;
            will-change: transform;
            transform-origin: 0 0;
            background-color: #1a472a; /* –¶–≤–µ—Ç –∑–µ–º–ª–∏ –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è */
            overflow: hidden;
        }
        
        /* –°–ê–ú–ê –ö–ê–†–¢–ê –ö–ê–ö –§–û–ù */
        .map-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('map.png') no-repeat center center,
                radial-gradient(circle at center, #2d5a3d 0%, #1a472a 70%, #0a291a 100%);
            background-size: cover;
            background-blend-mode: overlay;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        /* –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–õ–û–ò –ö–ê–†–¢–´ (–¥–ª—è –≥–ª—É–±–∏–Ω—ã) */
        .map-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        /* –ì–ï–ù–ï–†–ê–¶–ò–Ø –¢–û–ß–ï–ö-–î–ï–†–ï–í–¨–ï–í –ò –¢.–î. */
        .map-detail {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .tree {
            background: radial-gradient(circle, #2d5a3d 0%, #1a472a 70%, #0a291a 100%);
            box-shadow: 0 0 10px rgba(45, 90, 61, 0.5);
        }
        
        .mountain {
            background: radial-gradient(circle, #5a5a5a 0%, #3a3a3a 70%, #2a2a2a 100%);
            box-shadow: 0 0 15px rgba(90, 90, 90, 0.6);
        }
        
        .water {
            background: radial-gradient(circle, #2a5a7a 0%, #1a3a5a 70%, #0a2a4a 100%);
            box-shadow: 0 0 8px rgba(42, 90, 122, 0.4);
        }

        /* –≠–§–§–ï–ö–¢ –ö–õ–ò–ö–ê */
        .click-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.9) 0%, rgba(255,215,0,0.4) 30%, rgba(255,215,0,0) 70%);
            pointer-events: none;
            z-index: 100;
            animation: clickPulse 0.8s ease-out forwards;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255,215,0,0.7);
        }
        
        @keyframes clickPulse {
            0% {
                transform: translate(-50%, -50%) scale(0.3);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
            }
        }
        
        /* –í–¢–û–†–ò–ß–ù–´–ô –≠–§–§–ï–ö–¢ –ö–õ–ò–ö–ê */
        .click-ring {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,215,0,0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 99;
            animation: ringPulse 0.6s ease-out forwards;
            transform: translate(-50%, -50%);
        }
        
        @keyframes ringPulse {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
                border-width: 1px;
            }
        }

        /* UI –ü–ê–ù–ï–õ–¨ */
        .ui-panel {
            position: fixed; 
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 90%; 
            max-width: 500px;
            height: 50px; 
            background: rgba(0,0,0,0.9); 
            border: 2px solid #ffd700;
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            z-index: 1000; 
            border-radius: 10px;
            backdrop-filter: blur(10px);
            padding: 0 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.7);
        }
        .res { 
            color: #ffd700; 
            font-weight: bold; 
            font-family: sans-serif; 
            font-size: clamp(13px, 3vw, 15px); 
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 5px rgba(0,0,0,0.8);
        }

        /* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .controls {
            position: fixed;
            bottom: 25px;
            right: 25px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        .control-btn {
            width: 55px;
            height: 55px;
            background: rgba(139,0,0,0.8);
            border: 2px solid #ffd700;
            color: #ffd700;
            border-radius: 50%;
            font-size: 26px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .control-btn:hover, .control-btn:active {
            background: rgba(160,0,0,1);
            transform: scale(1.15);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        /* –ü–ê–ù–ï–õ–¨ –ò–ù–§–û–†–ú–ê–¶–ò–ò */
        .info-panel {
            position: fixed;
            top: 80px;
            left: 15px;
            background: rgba(0,0,0,0.85);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            color: white;
            min-width: 140px;
            backdrop-filter: blur(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        .info-panel h3 {
            color: #ffd700;
            margin: 0 0 12px 0;
            font-size: 16px;
            text-align: center;
            border-bottom: 1px solid rgba(255,215,0,0.3);
            padding-bottom: 8px;
        }
        
        .coord-display {
            font-size: 13px;
            margin: 8px 0;
            color: #ddd;
            display: flex;
            justify-content: space-between;
        }
        
        .coord-value {
            color: #ffd700;
            font-weight: bold;
        }
        
        /* –ò–ù–î–ò–ö–ê–¢–û–† –ì–†–ê–ù–ò–¶ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) */
        .boundary-indicator {
            position: fixed;
            border: 2px dashed rgba(255,215,0,0.3);
            pointer-events: none;
            z-index: 500;
            display: none;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="game-title">EMPIRE:<br>DAWN OF WAR</div>
        <div class="loader-wrap">
            <div class="loader-cont"><div id="progress"></div></div>
            <div id="percent" style="color:#ffd700; margin-top:10px; font-weight:bold;">0%</div>
        </div>
    </div>

    <div id="dialog-screen">
        <img src="marshal_blank.png" class="character-img">
        <div class="dialog-box">
            <h3 style="color:#ffd700; margin:0 0 10px 0;">–ú–ê–†–®–ê–õ –ö–ê–ô</h3>
            <p>–ú–æ–π –ª–æ—Ä–¥, –∫–∞—Ä—Ç–∞ –º–∏—Ä–∞ –≥–æ—Ç–æ–≤–∞. –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω! –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∂–µ—Å—Ç—ã –¥–ª—è –∑—É–º–∞.</p>
            <button class="btn-game" onclick="startGame()">–ü–†–ò–°–¢–£–ü–ò–¢–¨ –ö –ó–ê–í–û–ï–í–ê–ù–ò–Ø–ú</button>
        </div>
    </div>

    <div id="game-viewport">
        <div class="ui-panel">
            <div class="res">üå≤ <span id="wood">500</span></div>
            <div class="res">‚öîÔ∏è <span id="troops">200</span></div>
            <div class="res">üí∞ <span id="gold">100</span></div>
            <div class="res">üè∞ <span id="lands">1</span></div>
        </div>
        
        <div id="map-container">
            <div class="map-bg"></div>
            <!-- –î–µ—Ç–∞–ª–∏ –∫–∞—Ä—Ç—ã –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="zoomIn()" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
            <button class="control-btn" onclick="zoomOut()" title="–û—Ç–¥–∞–ª–∏—Ç—å">-</button>
            <button class="control-btn" onclick="resetView()" title="–°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥">‚åñ</button>
            <button class="control-btn" onclick="toggleBoundaries()" title="–ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã">‚ñ°</button>
        </div>
        
        <div class="info-panel" id="infoPanel">
            <h3>–ö–ê–†–¢–ê –ú–ò–†–ê</h3>
            <div class="coord-display">–ú–∞—Å—à—Ç–∞–±: <span class="coord-value" id="scaleValue">100%</span></div>
            <div class="coord-display">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: <span class="coord-value" id="coordValue">0,0</span></div>
            <div class="coord-display">–û–±–ª–∞—Å—Ç—å: <span class="coord-value" id="areaValue">–¶–µ–Ω—Ç—Ä</span></div>
            <div style="font-size: 11px; color: #aaa; margin-top: 12px; line-height: 1.4; border-top: 1px solid rgba(255,215,0,0.2); padding-top: 8px;">
                üñ±Ô∏è –ö–ª–∏–∫ - –≤—ã–±—Ä–∞—Ç—å<br>
                üñ±Ô∏è –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å - –¥–≤–∏–≥–∞—Ç—å<br>
                üîç –ö–æ–ª–µ—Å–æ - –∑—É–º<br>
                üì± 2 –ø–∞–ª—å—Ü–∞ - –∑—É–º
            </div>
        </div>
        
        <div class="boundary-indicator" id="boundaryIndicator"></div>
    </div>

    <script>
        // 1. –ó–ê–ì–†–£–ó–ö–ê
        let p = 0;
        let itv = setInterval(() => {
            p++;
            document.getElementById('progress').style.width = p + '%';
            document.getElementById('percent').innerText = p + '%';
            if(p >= 100) {
                clearInterval(itv);
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    document.getElementById('dialog-screen').style.display = 'flex';
                }, 500);
            }
        }, 70);

        let mapEngine = null;

        function startGame() {
            document.getElementById('dialog-screen').style.display = 'none';
            document.getElementById('game-viewport').style.display = 'block';
            mapEngine = initEngine();
        }

        // 2. –î–í–ò–ñ–û–ö –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–û–ô –ö–ê–†–¢–´
        function initEngine() {
            const container = document.getElementById('map-container');
            const viewport = document.getElementById('game-viewport');
            const infoPanel = document.getElementById('infoPanel');
            const scaleValue = document.getElementById('scaleValue');
            const coordValue = document.getElementById('coordValue');
            const areaValue = document.getElementById('areaValue');
            const boundaryIndicator = document.getElementById('boundaryIndicator');
            
            let scale = 1;
            let pos = { x: 0, y: 0 };
            let isDragging = false;
            let startDrag = { x: 0, y: 0 };
            let lastDist = 0;
            let lastTap = 0;
            let lastTapX = 0;
            let lastTapY = 0;
            let showBoundaries = false;

            // –ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ - –ö–ê–†–¢–ê –ó–ê–ù–ò–ú–ê–ï–¢ –í–°–Å!
            function adjustMapSize() {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–∏–Ω–∏–º—É–º –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ —ç–∫—Ä–∞–Ω–∞
                const containerWidth = Math.max(window.innerWidth * 2, 2000);
                const containerHeight = Math.max(window.innerHeight * 2, 2000);
                
                container.style.width = `${containerWidth}px`;
                container.style.height = `${containerHeight}px`;
                
                // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è - –ø–æ —Ü–µ–Ω—Ç—Ä—É
                pos.x = (window.innerWidth - containerWidth) / 2;
                pos.y = (window.innerHeight - containerHeight) / 2;
                
                // –ù–∞—á–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± - —á—Ç–æ–±—ã –∫–∞—Ä—Ç–∞ –∑–∞–ø–æ–ª–Ω–∏–ª–∞ —ç–∫—Ä–∞–Ω –ø–æ –º–µ–Ω—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ
                const minDimension = Math.min(window.innerWidth, window.innerHeight);
                const containerMin = Math.min(containerWidth, containerHeight);
                scale = minDimension / containerMin * 0.9;
                
                update();
                generateMapDetails();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                infoPanel.style.display = 'block';
                setTimeout(() => {
                    infoPanel.style.display = 'none';
                }, 5000);
            }

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª–µ–π –∫–∞—Ä—Ç—ã (–¥–µ—Ä–µ–≤—å—è, –≥–æ—Ä—ã –∏ —Ç.–¥.)
            function generateMapDetails() {
                const container = document.getElementById('map-container');
                
                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–µ—Ç–∞–ª–∏
                const oldDetails = container.querySelectorAll('.map-layer');
                oldDetails.forEach(el => el.remove());
                
                // –°–æ–∑–¥–∞–µ–º —Å–ª–æ–π –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
                const detailsLayer = document.createElement('div');
                detailsLayer.className = 'map-layer';
                container.appendChild(detailsLayer);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                const detailCount = 150; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–∞–ª–µ–π
                
                for(let i = 0; i < detailCount; i++) {
                    const detail = document.createElement('div');
                    detail.className = 'map-detail';
                    
                    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                    const left = Math.random() * 100;
                    const top = Math.random() * 100;
                    
                    // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                    const size = 20 + Math.random() * 60;
                    
                    // –°–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø
                    const type = Math.random();
                    let className = 'tree';
                    let zIndex = 1;
                    
                    if(type < 0.3) {
                        className = 'mountain';
                        zIndex = 2;
                    } else if(type < 0.5) {
                        className = 'water';
                        zIndex = 0;
                    }
                    
                    detail.classList.add(className);
                    detail.style.left = `${left}%`;
                    detail.style.top = `${top}%`;
                    detail.style.width = `${size}px`;
                    detail.style.height = `${size}px`;
                    detail.style.zIndex = zIndex;
                    
                    detailsLayer.appendChild(detail);
                }
            }

            function update() {
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∫–∞—Ä—Ç—ã
                container.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                scaleValue.textContent = `${Math.round(scale * 100)}%`;
                coordValue.textContent = `${Math.round(-pos.x)}, ${Math.round(-pos.y)}`;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±–ª–∞—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                updateAreaName();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
                const bounds = getMapBounds();
                constrainToBounds(bounds);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥—Ä–∞–Ω–∏—Ü –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if(showBoundaries) {
                    updateBoundaryIndicator(bounds);
                }
            }

            function getMapBounds() {
                const containerRect = container.getBoundingClientRect();
                const scaledWidth = containerRect.width * scale;
                const scaledHeight = containerRect.height * scale;
                
                return {
                    minX: window.innerWidth - scaledWidth,
                    maxX: 0,
                    minY: window.innerHeight - scaledHeight,
                    maxY: 0,
                    width: scaledWidth,
                    height: scaledHeight
                };
            }

            function constrainToBounds(bounds) {
                if(pos.x < bounds.minX) pos.x = bounds.minX;
                if(pos.x > bounds.maxX) pos.x = bounds.maxX;
                if(pos.y < bounds.minY) pos.y = bounds.minY;
                if(pos.y > bounds.maxY) pos.y = bounds.maxY;
            }

            function updateBoundaryIndicator(bounds) {
                boundaryIndicator.style.display = 'block';
                boundaryIndicator.style.left = `${bounds.minX}px`;
                boundaryIndicator.style.top = `${bounds.minY}px`;
                boundaryIndicator.style.width = `${bounds.width}px`;
                boundaryIndicator.style.height = `${bounds.height}px`;
            }

            function toggleBoundaries() {
                showBoundaries = !showBoundaries;
                boundaryIndicator.style.display = showBoundaries ? 'block' : 'none';
                if(showBoundaries) {
                    updateBoundaryIndicator(getMapBounds());
                }
            }

            function updateAreaName() {
                const centerX = -pos.x + window.innerWidth / 2 / scale;
                const centerY = -pos.y + window.innerHeight / 2 / scale;
                const containerWidth = parseInt(container.style.width);
                const containerHeight = parseInt(container.style.height);
                
                const percentX = centerX / containerWidth * 100;
                const percentY = centerY / containerHeight * 100;
                
                let area = "–¶–µ–Ω—Ç—Ä";
                
                if(percentX < 25) area = "–ó–∞–ø–∞–¥";
                else if(percentX > 75) area = "–í–æ—Å—Ç–æ–∫";
                
                if(percentY < 25) area = (area === "–¶–µ–Ω—Ç—Ä" ? "–°–µ–≤–µ—Ä" : area + "-–°–µ–≤–µ—Ä");
                else if(percentY > 75) area = (area === "–¶–µ–Ω—Ç—Ä" ? "–Æ–≥" : area + "-–Æ–≥");
                
                areaValue.textContent = area;
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞
            function createClickEffect(x, y) {
                // –ì–ª–∞–≤–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
                const effect = document.createElement('div');
                effect.className = 'click-effect';
                effect.style.left = `${x}px`;
                effect.style.top = `${y}px`;
                viewport.appendChild(effect);
                
                // –í—Ç–æ—Ä–∏—á–Ω–æ–µ –∫–æ–ª—å—Ü–æ
                const ring = document.createElement('div');
                ring.className = 'click-ring';
                ring.style.left = `${x}px`;
                ring.style.top = `${y}px`;
                viewport.appendChild(ring);
                
                // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è
                setTimeout(() => {
                    effect.remove();
                    ring.remove();
                }, 800);
                
                // –õ–æ–≥–∏–∫–∞ –∫–ª–∏–∫–∞ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏–≥—Ä–æ–π)
                const containerRect = container.getBoundingClientRect();
                const mapX = (x - containerRect.left - pos.x) / scale;
                const mapY = (y - containerRect.top - pos.y) / scale;
                
                console.log('–ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–µ:', { mapX: Math.round(mapX), mapY: Math.round(mapY) });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                infoPanel.style.display = 'block';
                setTimeout(() => {
                    if(!isDragging) infoPanel.style.display = 'none';
                }, 3000);
            }

            // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
            const onStart = (e) => {
                e.preventDefault();
                
                if (e.touches) {
                    if (e.touches.length === 1) {
                        // –û–¥–∏–Ω–∞—Ä–Ω—ã–π —Ç–∞–ø
                        const now = Date.now();
                        const t = e.touches[0];
                        const tapX = t.clientX;
                        const tapY = t.clientY;
                        
                        if (now - lastTap < 300 && 
                            Math.abs(tapX - lastTapX) < 25 && 
                            Math.abs(tapY - lastTapY) < 25) {
                            // –î–≤–æ–π–Ω–æ–π —Ç–∞–ø - –∑—É–º –∫ —Ç–æ—á–∫–µ
                            const targetScale = scale * 1.8;
                            scale = Math.min(3, Math.max(0.2, targetScale));
                            
                            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–∞ —Ç–æ—á–∫–µ —Ç–∞–ø–∞
                            pos.x = tapX - (tapX - pos.x) * (scale / targetScale * 1.8);
                            pos.y = tapY - (tapY - pos.y) * (scale / targetScale * 1.8);
                            
                            createClickEffect(tapX, tapY);
                        }
                        
                        lastTap = now;
                        lastTapX = tapX;
                        lastTapY = tapY;
                        
                        isDragging = true;
                        startDrag.x = t.clientX - pos.x;
                        startDrag.y = t.clientY - pos.y;
                        viewport.style.cursor = 'grabbing';
                    } else if (e.touches.length === 2) {
                        // –î–≤–∞ –ø–∞–ª—å—Ü–∞ - –∑—É–º
                        lastDist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        isDragging = true;
                    }
                } else {
                    // –ú—ã—à—å
                    isDragging = true;
                    startDrag.x = e.clientX - pos.x;
                    startDrag.y = e.clientY - pos.y;
                    viewport.style.cursor = 'grabbing';
                }
            };

            const onMove = (e) => {
                e.preventDefault();
                
                if (!isDragging) return;
                
                if (e.touches) {
                    if (e.touches.length === 2) {
                        // –ó—É–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
                        const dist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        
                        const delta = dist / lastDist;
                        const newScale = Math.max(0.2, Math.min(3, scale * delta));
                        
                        // –¶–µ–Ω—Ç—Ä –º–µ–∂–¥—É –ø–∞–ª—å—Ü–∞–º–∏
                        const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                        const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                        
                        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –∑—É–º–µ
                        pos.x = centerX - (centerX - pos.x) * (newScale / scale);
                        pos.y = centerY - (centerY - pos.y) * (newScale / scale);
                        
                        scale = newScale;
                        lastDist = dist;
                    } else if (e.touches.length === 1) {
                        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
                        const t = e.touches[0];
                        pos.x = t.clientX - startDrag.x;
                        pos.y = t.clientY - startDrag.y;
                    }
                } else {
                    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º—ã—à—å—é
                    pos.x = e.clientX - startDrag.x;
                    pos.y = e.clientY - startDrag.y;
                }
                
                update();
            };

            const onEnd = () => {
                isDragging = false;
                viewport.style.cursor = 'grab';
            };

            // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ
            const onClick = (e) => {
                if (e.touches) return; // –î–ª—è —Ç–∞—á–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
                createClickEffect(e.clientX, e.clientY);
            };

            // –ó—É–º –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
            const onWheel = (e) => {
                e.preventDefault();
                
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.max(0.2, Math.min(3, scale * delta));
                
                // –¶–µ–Ω—Ç—Ä –∑—É–º–∞ - –∫—É—Ä—Å–æ—Ä –º—ã—à–∏
                const mouseX = e.clientX;
                const mouseY = e.clientY;
                
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é
                pos.x = mouseX - (mouseX - pos.x) * (newScale / scale);
                pos.y = mouseY - (mouseY - pos.y) * (newScale / scale);
                
                scale = newScale;
                update();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
                infoPanel.style.display = 'block';
            };

            // –ü–†–ò–í–Ø–ó–ö–ê –°–û–ë–´–¢–ò–ô
            viewport.addEventListener('mousedown', onStart);
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            viewport.addEventListener('click', onClick);
            viewport.addEventListener('wheel', onWheel, { passive: false });
            
            viewport.addEventListener('touchstart', onStart, { passive: false });
            viewport.addEventListener('touchmove', onMove, { passive: false });
            viewport.addEventListener('touchend', onEnd);
            viewport.addEventListener('touchcancel', onEnd);

            // –†–µ—Å–∞–π–∑ –æ–∫–Ω–∞
            window.addEventListener('resize', adjustMapSize);
            
            // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
            adjustMapSize();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º API
            return {
                zoomIn: () => {
                    const newScale = Math.min(3, scale * 1.3);
                    const centerX = window.innerWidth / 2;
                    const centerY = window.innerHeight / 2;
                    
                    pos.x = centerX - (centerX - pos.x) * (newScale / scale);
                    pos.y = centerY - (centerY - pos.y) * (newScale / scale);
                    
                    scale = newScale;
                    update();
                },
                zoomOut: () => {
                    const newScale = Math.max(0.2, scale * 0.7);
                    const centerX = window.innerWidth / 2;
                    const centerY = window.innerHeight / 2;
                    
                    pos.x = centerX - (centerX - pos.x) * (newScale / scale);
                    pos.y = centerY - (centerY - pos.y) * (newScale / scale);
                    
                    scale = newScale;
                    update();
                },
                resetView: () => {
                    adjustMapSize();
                },
                toggleBoundaries: toggleBoundaries
            };
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function zoomIn() {
            if (mapEngine) mapEngine.zoomIn();
        }
        
        function zoomOut() {
            if (mapEngine) mapEngine.zoomOut();
        }
        
        function resetView() {
            if (mapEngine) mapEngine.resetView();
        }
        
        function toggleBoundaries() {
            if (mapEngine) mapEngine.toggleBoundaries();
        }

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –¥—Ä–∞–≥–µ
        document.addEventListener('selectstart', e => e.preventDefault());
    </script>
</body>
</html>
