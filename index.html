<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Empire: Dawn of War</title>
    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
        }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: #000; 
            position: fixed; 
            font-family: 'Arial', sans-serif;
        }

        /* –ó–ê–ì–†–£–ó–ö–ê 7 –°–ï–ö–£–ù–î */
        #loading-screen {
            position: fixed; 
            inset: 0; 
            background: url('bg.png') no-repeat center center / cover;
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
            align-items: center;
            z-index: 5000; 
            padding: 60px 0;
        }
        .game-title { 
            color: #ffd700; 
            font-size: clamp(24px, 5vw, 32px); 
            font-weight: bold; 
            text-align: center; 
            text-shadow: 0 0 15px #000; 
            text-transform: uppercase; 
            font-family: serif; 
        }
        .loader-wrap { 
            width: 85%; 
            max-width: 400px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .loader-cont { 
            width: 100%; 
            height: 26px; 
            background: #000; 
            border: 4px solid #ffd700; 
            position: relative; 
            border-radius: 4px;
            overflow: hidden;
        }
        #progress { 
            width: 0%; 
            height: 100%; 
            background: linear-gradient(180deg, #fff2ac, #ffd700, #b8860b);
            transition: width 0.1s ease;
        }

        /* –î–ò–ê–õ–û–ì –í –†–ê–ú–ö–ï */
        #dialog-screen { 
            position: fixed; 
            inset: 0; 
            z-index: 4000; 
            display: none;
            background: linear-gradient(to bottom, transparent 20%, #000 90%);
            flex-direction: column; 
            justify-content: flex-end; 
            align-items: center;
        }
        .character-img { 
            height: 75%; 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            z-index: 1; 
            object-fit: contain;
        }
        .dialog-box { 
            width: 100%; 
            background: rgba(10, 10, 10, 0.98); 
            border-top: 4px solid #ffd700; 
            padding: 30px 20px; 
            color: white; 
            z-index: 10; 
            font-family: serif; 
        }
        .btn-game { 
            background: #8b0000; 
            color: #ffd700; 
            border: 2px solid #ffd700; 
            padding: 18px; 
            width: 100%; 
            margin-top: 15px; 
            font-weight: bold; 
            text-transform: uppercase; 
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .btn-game:hover {
            background: #a00000;
        }

        /* –ò–ì–†–û–í–û–ô –ú–ò–† */
        #game-viewport { 
            width: 100vw; 
            height: 100vh; 
            position: relative; 
            display: none; 
            overflow: hidden; 
            cursor: grab;
            touch-action: none;
        }
        
        /* –ö–ê–†–¢–ê - –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –†–ê–ó–ú–ï–† */
        #map-layer {
            position: absolute;
            width: 4000px; /* –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
            height: 4000px;
            background: url('map.png') no-repeat center center;
            background-size: cover;
            will-change: transform;
            transform-origin: 0 0;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* –≠–§–§–ï–ö–¢ –ö–õ–ò–ö–ê */
        .click-effect {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, rgba(255,215,0,0) 70%);
            pointer-events: none;
            z-index: 100;
            animation: clickPulse 0.6s ease-out forwards;
        }
        
        @keyframes clickPulse {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* UI –ü–ê–ù–ï–õ–¨ */
        .ui-panel {
            position: fixed; 
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%);
            width: 90%; 
            max-width: 500px;
            height: 45px; 
            background: rgba(0,0,0,0.85); 
            border: 2px solid #ffd700;
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            z-index: 1000; 
            border-radius: 8px;
            backdrop-filter: blur(5px);
            padding: 0 20px;
        }
        .res { 
            color: #ffd700; 
            font-weight: bold; 
            font-family: sans-serif; 
            font-size: clamp(12px, 3vw, 14px); 
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #ffd700;
            color: #ffd700;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(139,0,0,0.7);
            transform: scale(1.1);
        }
        
        /* –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ */
        .side-panel {
            position: fixed;
            top: 80px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 10px;
            z-index: 1000;
            color: white;
            min-width: 120px;
            display: none;
        }
        
        .side-panel h3 {
            color: #ffd700;
            margin: 0 0 10px 0;
            font-size: 14px;
            text-align: center;
        }
        
        .coord-display {
            font-size: 12px;
            margin: 5px 0;
            color: #ccc;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="game-title">EMPIRE:<br>DAWN OF WAR</div>
        <div class="loader-wrap">
            <div class="loader-cont"><div id="progress"></div></div>
            <div id="percent" style="color:#ffd700; margin-top:10px; font-weight:bold;">0%</div>
        </div>
    </div>

    <div id="dialog-screen">
        <img src="marshal_blank.png" class="character-img">
        <div class="dialog-box">
            <h3 style="color:#ffd700; margin:0 0 10px 0;">–ú–ê–†–®–ê–õ –ö–ê–ô</h3>
            <p>–ú–æ–π –ª–æ—Ä–¥, –∫–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞. –ú—ã –≤–µ—Ä–Ω—É–ª–∏ –≤—Å—ë –∫–∞–∫ –±—ã–ª–æ, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ —Å–ª—É—à–∞–µ—Ç—Å—è –≤–∞—à–∏—Ö –∫–æ–º–∞–Ω–¥. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –¥–ª—è –∑—É–º–∞, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ –∫–∞—Ä—Ç–µ.</p>
            <button class="btn-game" onclick="startGame()">–í–°–¢–£–ü–ò–¢–¨ –í –ü–†–ê–í–ê</button>
        </div>
    </div>

    <div id="game-viewport">
        <div class="ui-panel">
            <div class="res">üå≤ <span id="wood">500</span></div>
            <div class="res">‚öîÔ∏è <span id="troops">200</span></div>
            <div class="res">üí∞ <span id="gold">100</span></div>
        </div>
        
        <div id="map-layer"></div>
        
        <div class="controls">
            <button class="control-btn" onclick="zoomIn()">+</button>
            <button class="control-btn" onclick="zoomOut()">-</button>
            <button class="control-btn" onclick="resetView()">‚åñ</button>
        </div>
        
        <div class="side-panel" id="info-panel">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="coord-display">–ú–∞—Å—à—Ç–∞–±: <span id="scale-value">100%</span></div>
            <div class="coord-display" id="coord-display">X: 0, Y: 0</div>
            <div style="font-size: 11px; color: #aaa; margin-top: 10px;">
                –î–≤–æ–π–Ω–æ–π —Ç–∞–ø –¥–ª—è –∑—É–º–∞<br>
                –î–≤–∞ –ø–∞–ª—å—Ü–∞ –¥–ª—è –∑—É–º–∞
            </div>
        </div>
    </div>

    <script>
        // 1. –ó–ê–ì–†–£–ó–ö–ê
        let p = 0;
        let itv = setInterval(() => {
            p++;
            document.getElementById('progress').style.width = p + '%';
            document.getElementById('percent').innerText = p + '%';
            if(p >= 100) {
                clearInterval(itv);
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('dialog-screen').style.display = 'flex';
            }
        }, 70);

        let mapEngine = null;

        function startGame() {
            document.getElementById('dialog-screen').style.display = 'none';
            document.getElementById('game-viewport').style.display = 'block';
            mapEngine = initEngine();
        }

        // 2. –£–õ–£–ß–®–ï–ù–ù–´–ô –î–í–ò–ñ–û–ö –ö–ê–†–¢–´
        function initEngine() {
            const map = document.getElementById('map-layer');
            const viewport = document.getElementById('game-viewport');
            const infoPanel = document.getElementById('info-panel');
            const scaleValue = document.getElementById('scale-value');
            const coordDisplay = document.getElementById('coord-display');
            
            let scale = 1;
            let pos = { x: -window.innerWidth/2, y: -window.innerHeight/2 };
            let isDragging = false;
            let startDrag = { x: 0, y: 0 };
            let lastDist = 0;
            let lastTap = 0;
            let lastTapX = 0;
            let lastTapY = 0;

            // –ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞
            function adjustMapSize() {
                const aspectRatio = 4000/4000; // –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω –∫–∞—Ä—Ç—ã
                const screenAspect = window.innerWidth / window.innerHeight;
                
                if (screenAspect > aspectRatio) {
                    // –®–∏—Ä–æ–∫–∏–π —ç–∫—Ä–∞–Ω
                    scale = window.innerHeight / 4000 * 1.2;
                } else {
                    // –í—ã—Å–æ–∫–∏–π —ç–∫—Ä–∞–Ω
                    scale = window.innerWidth / 4000 * 1.2;
                }
                
                pos.x = -window.innerWidth/2;
                pos.y = -window.innerHeight/2;
                
                update();
            }

            function update() {
                map.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(${scale})`;
                scaleValue.textContent = `${Math.round(scale * 100)}%`;
                coordDisplay.textContent = `X: ${Math.round(-pos.x)}, Y: ${Math.round(-pos.y)}`;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã
                const bounds = getMapBounds();
                if (pos.x > bounds.maxX) pos.x = bounds.maxX;
                if (pos.x < bounds.minX) pos.x = bounds.minX;
                if (pos.y > bounds.maxY) pos.y = bounds.maxY;
                if (pos.y < bounds.minY) pos.y = bounds.minY;
            }

            function getMapBounds() {
                const mapWidth = 4000 * scale;
                const mapHeight = 4000 * scale;
                
                return {
                    minX: -mapWidth + window.innerWidth * 0.8,
                    maxX: -window.innerWidth * 0.2,
                    minY: -mapHeight + window.innerHeight * 0.8,
                    maxY: -window.innerHeight * 0.2
                };
            }

            // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞
            function createClickEffect(x, y) {
                const effect = document.createElement('div');
                effect.className = 'click-effect';
                effect.style.left = `${x - 20}px`;
                effect.style.top = `${y - 20}px`;
                document.getElementById('game-viewport').appendChild(effect);
                
                setTimeout(() => {
                    effect.remove();
                }, 600);
            }

            const onStart = (e) => {
                e.preventDefault();
                
                if (e.touches) {
                    if (e.touches.length === 1) {
                        // –û–¥–∏–Ω–∞—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
                        const now = Date.now();
                        const t = e.touches[0];
                        const tapX = t.clientX;
                        const tapY = t.clientY;
                        
                        if (now - lastTap < 300 && 
                            Math.abs(tapX - lastTapX) < 20 && 
                            Math.abs(tapY - lastTapY) < 20) {
                            // –î–≤–æ–π–Ω–æ–π —Ç–∞–ø
                            const targetScale = scale * 1.5;
                            scale = Math.min(1.5, Math.max(0.3, targetScale));
                            
                            // –°–º–µ—â–µ–Ω–∏–µ –∫ —Ç–æ—á–∫–µ —Ç–∞–ø–∞
                            const rect = viewport.getBoundingClientRect();
                            const relativeX = (tapX - rect.left) / rect.width;
                            const relativeY = (tapY - rect.top) / rect.height;
                            
                            const mapRect = getMapBounds();
                            pos.x = -relativeX * (4000 * scale) + tapX;
                            pos.y = -relativeY * (4000 * scale) + tapY;
                            
                            createClickEffect(tapX, tapY);
                        }
                        
                        lastTap = now;
                        lastTapX = tapX;
                        lastTapY = tapY;
                        
                        isDragging = true;
                        startDrag.x = t.clientX - pos.x;
                        startDrag.y = t.clientY - pos.y;
                    } else if (e.touches.length === 2) {
                        // –î–≤–∞ –ø–∞–ª—å—Ü–∞ - –∑—É–º
                        lastDist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                    }
                } else {
                    // –ú—ã—à—å
                    isDragging = true;
                    startDrag.x = e.clientX - pos.x;
                    startDrag.y = e.clientY - pos.y;
                    viewport.style.cursor = 'grabbing';
                }
                
                infoPanel.style.display = 'block';
            };

            const onMove = (e) => {
                e.preventDefault();
                
                if (!isDragging) return;
                
                if (e.touches) {
                    if (e.touches.length === 2) {
                        // –ó—É–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
                        const dist = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        
                        const delta = dist / lastDist;
                        const newScale = Math.max(0.3, Math.min(1.5, scale * delta));
                        
                        // –¶–µ–Ω—Ç—Ä –∑—É–º–∞ –º–µ–∂–¥—É –ø–∞–ª—å—Ü–∞–º–∏
                        const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
                        const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
                        
                        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –∑—É–º–µ
                        const scaleRatio = newScale / scale;
                        pos.x = centerX - (centerX - pos.x) * scaleRatio;
                        pos.y = centerY - (centerY - pos.y) * scaleRatio;
                        
                        scale = newScale;
                        lastDist = dist;
                    } else if (e.touches.length === 1) {
                        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–¥–Ω–∏–º –ø–∞–ª—å—Ü–µ–º
                        const t = e.touches[0];
                        pos.x = t.clientX - startDrag.x;
                        pos.y = t.clientY - startDrag.y;
                    }
                } else {
                    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º—ã—à—å—é
                    pos.x = e.clientX - startDrag.x;
                    pos.y = e.clientY - startDrag.y;
                }
                
                update();
            };

            const onEnd = () => {
                isDragging = false;
                viewport.style.cursor = 'grab';
                
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (!isDragging) {
                        infoPanel.style.display = 'none';
                    }
                }, 3000);
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
            const onClick = (e) => {
                if (e.touches) return; // –î–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ—Ç–¥–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
                
                createClickEffect(e.clientX, e.clientY);
                
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–±–æ—Ä —é–Ω–∏—Ç–∞ –∏–ª–∏ –ø–æ—Å—Ç—Ä–æ–π–∫–∏
                console.log('–ö–ª–∏–∫ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º:', {
                    screenX: e.clientX,
                    screenY: e.clientY,
                    mapX: Math.round((-pos.x + e.clientX) / scale),
                    mapY: Math.round((-pos.y + e.clientY) / scale)
                });
            };

            // –ó—É–º –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
            const onWheel = (e) => {
                e.preventDefault();
                
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.max(0.3, Math.min(1.5, scale * delta));
                
                // –¶–µ–Ω—Ç—Ä –∑—É–º–∞ - –ø–æ–∑–∏—Ü–∏—è –º—ã—à–∏
                const rect = viewport.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –∑—É–º–µ
                const scaleRatio = newScale / scale;
                pos.x = mouseX - (mouseX - pos.x) * scaleRatio;
                pos.y = mouseY - (mouseY - pos.y) * scaleRatio;
                
                scale = newScale;
                update();
                
                infoPanel.style.display = 'block';
            };

            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
            viewport.addEventListener('mousedown', onStart);
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            viewport.addEventListener('click', onClick);
            viewport.addEventListener('wheel', onWheel, { passive: false });
            
            viewport.addEventListener('touchstart', onStart, { passive: false });
            viewport.addEventListener('touchmove', onMove, { passive: false });
            viewport.addEventListener('touchend', onEnd);
            viewport.addEventListener('touchcancel', onEnd);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å–∞–π–∑–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', adjustMapSize);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            adjustMapSize();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º API –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            return {
                zoomIn: () => {
                    scale = Math.min(1.5, scale * 1.2);
                    update();
                },
                zoomOut: () => {
                    scale = Math.max(0.3, scale * 0.8);
                    update();
                },
                resetView: () => {
                    adjustMapSize();
                },
                getScale: () => scale,
                getPosition: () => ({...pos})
            };
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function zoomIn() {
            if (mapEngine) mapEngine.zoomIn();
        }
        
        function zoomOut() {
            if (mapEngine) mapEngine.zoomOut();
        }
        
        function resetView() {
            if (mapEngine) mapEngine.resetView();
        }

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
